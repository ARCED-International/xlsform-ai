<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Log - XLSForm</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        :root {
            --color-primary: #2C5F7D;
            --color-primary-light: #3d7aa0;
            --color-primary-dark: #1e4256;
            --color-secondary: #97C8EB;
            --color-accent: #E8A87C;
            --color-success: #4A9C6D;
            --color-warning: #D9A84B;
            --color-error: #C75B5B;
            --color-gray-50: #FAFAFA;
            --color-gray-100: #F5F5F5;
            --color-gray-200: #EEEEEE;
            --color-gray-300: #E0E0E0;
            --color-gray-400: #BDBDBD;
            --color-gray-500: #9E9E9E;
            --color-gray-600: #757575;
            --color-gray-700: #616161;
            --color-gray-800: #424242;
            --color-gray-900: #212121;
            --font-display: 'Work Sans', -apple-system, sans-serif;
            --font-serif: 'Crimson Pro', Georgia, serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 10px;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-display);
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-gray-800);
            background: linear-gradient(135deg, var(--color-gray-50) 0%, var(--color-gray-100) 100%);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ========== HEADER ========== */
        .header {
            background: white;
            border-bottom: 1px solid var(--color-gray-200);
            padding: 2rem 2.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }

        .header-branding {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .logo {
            height: 52px;
            width: auto;
            object-fit: contain;
            flex-shrink: 0;
        }

        .header-titles {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .header-title {
            font-family: var(--font-serif);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-gray-900);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: var(--color-gray-500);
            font-weight: 500;
        }

        .header-form-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-size: 0.75rem;
            color: var(--color-gray-500);
        }

        .header-meta {
            display: flex;
            gap: 2rem;
            font-size: 0.8125rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-link {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.6rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-gray-200);
            background: white;
            color: var(--color-gray-600);
            font-size: 0.75rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
        }

        .header-link:hover {
            color: var(--color-gray-900);
            border-color: var(--color-gray-300);
            background: var(--color-gray-50);
        }

        .header-link svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .meta-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-gray-400);
        }

        .meta-value {
            font-weight: 600;
            color: var(--color-gray-700);
        }

        /* ========== MAIN CONTENT ========== */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 2.5rem;
        }

        /* ========== SUMMARY CARDS ========== */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .summary-card {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .summary-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-gray-500);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-gray-900);
        }

        .summary-subtext {
            font-size: 0.75rem;
            color: var(--color-gray-500);
            margin-top: 0.25rem;
        }

        /* ========== BUTTONS ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: var(--font-display);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background: white;
            color: var(--color-gray-700);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .btn:hover {
            background: var(--color-gray-50);
            border-color: var(--color-gray-400);
            color: var(--color-gray-900);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-dark);
            border-color: var(--color-primary-dark);
        }

        .divider {
            width: 1px;
            height: 24px;
            background: var(--color-gray-300);
        }

        /* ========== FILTERS ========== */
        .filters {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: end;
            box-shadow: var(--shadow-sm);
        }

        .filter-actions {
            margin-left: auto;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-gray-300);
            background: white;
            color: var(--color-gray-600);
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .icon-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .icon-btn:hover {
            color: var(--color-gray-900);
            border-color: var(--color-gray-400);
            background: var(--color-gray-50);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .filter-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-gray-500);
        }

        .filter-input {
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-family: var(--font-display);
            background: white;
            min-width: 160px;
            transition: var(--transition);
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(44, 95, 125, 0.1);
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
        }

        .results-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: var(--color-primary);
            color: white;
            border-radius: var(--radius-md);
            font-size: 0.8125rem;
            font-weight: 600;
        }

        /* ========== TABLE ========== */
        .table-wrapper {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 600px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.875rem;
        }

        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--color-gray-50);
        }

        .data-table th {
            position: relative;
            padding: 0;
            background: var(--color-gray-50);
            border-bottom: 2px solid var(--color-primary);
            border-right: 1px solid var(--color-gray-200);
            user-select: none;
            cursor: pointer;
            transition: background var(--transition);
        }

        .data-table th:last-child {
            border-right: none;
        }

        .data-table th:hover {
            background: var(--color-gray-100);
        }

        .th-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 1rem;
            gap: 0.5rem;
        }

        .th-text {
            font-family: var(--font-display);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-gray-700);
        }

        .sort-indicator {
            font-size: 0.625rem;
            color: var(--color-gray-400);
            transition: color var(--transition);
        }

        .data-table th.sort-asc .sort-indicator::after {
            content: '\25B2';
            color: var(--color-primary);
        }

        .data-table th.sort-desc .sort-indicator::after {
            content: '\25BC';
            color: var(--color-primary);
        }

        .resize-handle {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            background: transparent;
            transition: background var(--transition);
        }

        .resize-handle:hover, .resize-handle.active {
            background: var(--color-primary);
        }

        .data-table tbody tr {
            border-bottom: 1px solid var(--color-gray-100);
            transition: background var(--transition);
        }

        .data-table tbody tr:hover {
            background: var(--color-gray-50);
        }

        .data-table td {
            padding: 0.875rem 1rem;
            border-right: 1px solid var(--color-gray-100);
        }

        .data-table td:last-child {
            border-right: none;
        }

        /* Cell Styles */
        .cell-date {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .date-main {
            font-weight: 600;
            color: var(--color-gray-900);
            font-size: 0.875rem;
        }

        .date-time {
            font-size: 0.75rem;
            color: var(--color-gray-500);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            background: var(--color-primary);
            color: white;
            border-radius: var(--radius-sm);
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .cell-description {
            font-weight: 500;
            color: var(--color-gray-800);
        }

        .cell-author {
        }

        .cell-author-content {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .author-icon {
            font-size: 1rem;
        }

        .cell-details-preview {
            color: var(--color-gray-600);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: color var(--transition);
        }

        .cell-details-preview-content {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cell-details-preview:hover {
            color: var(--color-primary);
        }

        .expand-icon {
            font-size: 0.625rem;
            transition: transform var(--transition);
        }

        .table-row.expanded .expand-icon {
            transform: rotate(90deg);
        }

        /* Details Row */
        .table-row-details {
            background: var(--color-gray-50);
        }

        .details-container {
            padding: 1.5rem;
        }

        .details-section {
            margin-bottom: 1rem;
        }

        .details-section:last-child {
            margin-bottom: 0;
        }

        .details-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-gray-500);
            margin-bottom: 0.5rem;
        }

        .details-content {
            background: white;
            padding: 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-gray-200);
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            color: var(--color-gray-700);
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.6;
            max-height: 250px;
            overflow-y: auto;
        }

        .details-meta {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            font-size: 0.8125rem;
            color: var(--color-gray-600);
        }

        .details-meta span {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        /* ========== PAGINATION ========== */
        .pagination {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            box-shadow: var(--shadow-sm);
        }

        .pagination-info {
            font-size: 0.875rem;
            color: var(--color-gray-600);
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-page {
            padding: 0.5rem 0.75rem;
            background: white;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
        }

        .btn-page:hover:not(:disabled) {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .btn-page:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-info {
            padding: 0 0.75rem;
            font-size: 0.875rem;
            color: var(--color-gray-600);
            font-weight: 500;
        }

        .pagination-size select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            cursor: pointer;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 420px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .modal-title {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-gray-900);
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            color: var(--color-gray-400);
            padding: 0.25rem;
            transition: color var(--transition);
        }

        .btn-close:hover {
            color: var(--color-gray-900);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
        }

        .column-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 0;
            border-bottom: 1px solid var(--color-gray-100);
        }

        .column-toggle:last-child {
            border-bottom: none;
        }

        .column-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .column-toggle label {
            font-size: 0.9375rem;
            color: var(--color-gray-700);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        .btn-export-option {
            width: 100%;
            padding: 0.875rem 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-export-option:last-child {
            margin-bottom: 0;
        }

        .btn-export-option:hover {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        /* ========== TOAST ========== */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--color-gray-900);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            opacity: 0;
            transform: translateY(1rem);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            font-weight: 500;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-success {
            background: var(--color-success);
        }

        .toast-error {
            background: var(--color-error);
        }

        /* ========== EMPTY STATE ========== */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            display: none;
        }

        .no-results.active {
            display: block;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.4;
        }

        .no-results-text {
            font-size: 1.125rem;
            color: var(--color-gray-700);
            font-weight: 500;
        }

        /* ========== FOOTER (HIDDEN) ========== */
        .footer {
            display: none;
        }

        .page-footer {
            max-width: 1400px;
            margin: 2rem auto 3rem;
            padding: 0 2.5rem;
            color: var(--color-gray-500);
            font-size: 0.8125rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: space-between;
            align-items: center;
        }

        .page-footer a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .page-footer a:hover {
            text-decoration: underline;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1024px) {
            .header {
                padding: 1.5rem;
            }

            .main {
                padding: 1.5rem;
            }

            .header-meta {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-left, .toolbar-right {
                width: 100%;
                justify-content: space-between;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                width: 100%;
            }

            .filter-input, .search-box {
                width: 100%;
            }

            .pagination {
                flex-direction: column;
                align-items: stretch;
            }

            .pagination-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* ========== PRINT STYLES ========== */
        @media print {
            .toolbar, .filters, .pagination {
                display: none !important;
            }

            .table-row-details {
                page-break-inside: avoid;
            }
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(0.5rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .data-table tbody tr {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-inner">
            <div class="header-branding">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTIiIGhlaWdodD0iNTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUyIiBoZWlnaHQ9IjUyIiByeD0iNiIgZmlsbD0iIzJDNUY3RCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiPkFJPC90ZXh0Pjwvc3ZnPg==" alt="Logo" class="logo">
                <div class="header-titles">
                    <h1 class="header-title">Activity Log - XLSForm</h1>
                    <div class="header-subtitle">Track changes and collaboration</div>
                    <div class="header-form-meta">
                        <span id="meta-form-title">Form title: -</span>
                        <span id="meta-form-id">Form ID: -</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a class="header-link" href="https://github.com/ARCED-International/xlsform-ai" target="_blank" rel="noopener" title="View on GitHub">
                    <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    <span>GitHub</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main">
        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-label">Total Actions</div>
                <div class="summary-value" id="summary-total">0</div>
                <div class="summary-subtext" id="summary-total-sub">All logged entries</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Unique Authors</div>
                <div class="summary-value" id="summary-authors">0</div>
                <div class="summary-subtext" id="summary-authors-sub">Contributors captured</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Date Range</div>
                <div class="summary-value" id="summary-range">-</div>
                <div class="summary-subtext" id="summary-range-sub">Across all activity</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Last Updated</div>
                <div class="summary-value" id="summary-updated">-</div>
                <div class="summary-subtext" id="summary-updated-sub">Most recent activity</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label class="filter-label" for="filter-action-type">Action Type</label>
                <select id="filter-action-type" class="filter-input">
                    <option value="">All Types</option>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label" for="filter-author">Author</label>
                <select id="filter-author" class="filter-input">
                    <option value="">All Authors</option>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label" for="filter-date-from">From Date</label>
                <input type="date" id="filter-date-from" class="filter-input">
            </div>

            <div class="filter-group">
                <label class="filter-label" for="filter-date-to">To Date</label>
                <input type="date" id="filter-date-to" class="filter-input">
            </div>

            <div class="filter-group" style="flex: 1;">
                <input type="text" id="filter-search" class="filter-input search-box" placeholder="Search activities...">
            </div>

            <div class="results-badge" id="results-count">1 shown</div>

            <button class="btn" id="btn-clear">Clear</button>

            <div class="filter-actions">
                <button class="icon-btn" id="btn-columns" title="Show/Hide Columns">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M1.5 12s3.8-7 10.5-7 10.5 7 10.5 7-3.8 7-10.5 7S1.5 12 1.5 12z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
                <button class="icon-btn" id="btn-export" title="Export">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M12 3v12"></path>
                        <path d="M7 10l5 5 5-5"></path>
                        <path d="M5 21h14"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Table -->
        <div class="table-wrapper">
            <div class="table-container">
                <table class="data-table" id="activity-table">
                    <thead>
                        <tr>
                            <th data-column="date" data-width="160">
                                <div class="th-content">
                                    <span class="th-text">Date & Time</span>
                                    <span class="sort-indicator"></span>
                                </div>
                                <div class="resize-handle"></div>
                            </th>
                            <th data-column="action_type" data-width="140">
                                <div class="th-content">
                                    <span class="th-text">Action</span>
                                    <span class="sort-indicator"></span>
                                </div>
                                <div class="resize-handle"></div>
                            </th>
                            <th data-column="description" data-width="280">
                                <div class="th-content">
                                    <span class="th-text">Description</span>
                                    <span class="sort-indicator"></span>
                                </div>
                                <div class="resize-handle"></div>
                            </th>
                            <th data-column="author" data-width="160">
                                <div class="th-content">
                                    <span class="th-text">Author</span>
                                    <span class="sort-indicator"></span>
                                </div>
                                <div class="resize-handle"></div>
                            </th>
                            <th data-column="details" data-width="220">
                                <div class="th-content">
                                    <span class="th-text">Details</span>
                                    <span class="sort-indicator"></span>
                                </div>
                                <div class="resize-handle"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- No Results -->
            <div class="no-results" id="no-results">
            <div class="no-results-icon">&#x1F50D;</div>
            <div class="no-results-text">No activities match your filters</div>
        </div>
    </div>

        <!-- Pagination -->
        <div class="pagination">
            <div class="pagination-info">
                Showing <span id="page-start">1</span>-<span id="page-end">1</span> of <span id="total-rows">1</span>
            </div>
            <div class="pagination-controls">
                <button class="btn-page" id="btn-first" title="First page">&#x23EE;</button>
                <button class="btn-page" id="btn-prev" title="Previous">&#x25C0;</button>
                <span class="page-info">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                <button class="btn-page" id="btn-next" title="Next">&#x25B6;</button>
                <button class="btn-page" id="btn-last" title="Last page">&#x23ED;</button>
            </div>
            <div class="pagination-size">
                <select id="rows-per-page">
                    <option value="10">10 rows</option>
                    <option value="25">25 rows</option>
                    <option value="50">50 rows</option>
                    <option value="100">100 rows</option>
                    <option value="-1">All</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Column Visibility Modal -->
    <div class="modal" id="columns-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Show/Hide Columns</h3>
                <button class="btn-close" id="btn-close-columns">&times;</button>
            </div>
            <div class="modal-body">
                <div class="column-toggle">
                    <input type="checkbox" id="col-date" checked data-column="date">
                    <label for="col-date">Date & Time</label>
                </div>
                <div class="column-toggle">
                    <input type="checkbox" id="col-action_type" checked data-column="action_type">
                    <label for="col-action_type">Action Type</label>
                </div>
                <div class="column-toggle">
                    <input type="checkbox" id="col-description" checked data-column="description">
                    <label for="col-description">Description</label>
                </div>
                <div class="column-toggle">
                    <input type="checkbox" id="col-author" checked data-column="author">
                    <label for="col-author">Author</label>
                </div>
                <div class="column-toggle">
                    <input type="checkbox" id="col-details" checked data-column="details">
                    <label for="col-details">Details</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Export Data</h3>
                <button class="btn-close" id="btn-close-export">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn-export-option" id="btn-export-csv">
                    <span>&#x1F4C4;</span>
                    <span>Export as CSV</span>
                </button>
                <button class="btn-export-option" id="btn-export-json">
                    <span>&#x1F4CB;</span>
                    <span>Export as JSON</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <div class="page-footer">
        <div>Report automatically generated by <a href="https://github.com/ARCED-International/xlsform-ai" target="_blank" rel="noopener">XLSForm AI</a>.</div>
        <div>Made with &#x2764; by <a href="https://arced-international.com" target="_blank" rel="noopener">ARCED International</a>.</div>
    </div>

    <!-- Footer (Hidden - contains data) -->
    <div class="footer">
        <!-- XLSFORM_AI_DATA_START -->
        {DATA}
        <!-- XLSFORM_AI_DATA_END -->
    </div>

    <!-- JavaScript -->
    <script>
        (function() {
            'use strict';

            // ========== DATA LOADING ==========
            let activityData = { entries: [], total_actions: 0 };
            let filteredEntries = [];
            let currentPage = 1;
            let rowsPerPage = 10;
            let currentSort = { column: 'date', direction: 'desc' };
            let selectedRows = new Set();

            // Load data from footer
            function loadData() {
                try {
                    const footer = document.querySelector('.footer');

                    // Get the innerHTML and extract JSON between comments
                    let htmlContent = footer.innerHTML;

                    // Extract the JSON content between the comment markers
                    const jsonMatch = htmlContent.match(/<!--\s*XLSFORM_AI_DATA_START\s*-->([\s\S]*?)<!--\s*XLSFORM_AI_DATA_END\s*-->/);

                    if (jsonMatch && jsonMatch[1]) {
                        const jsonStr = jsonMatch[1].trim();
                        activityData = JSON.parse(jsonStr);
                        filteredEntries = [...activityData.entries];
                        updateMetaInfo();
                        console.log('Successfully loaded activity data:', activityData.total_actions, 'entries');
                        return true;
                    } else {
                        console.error('Could not find data markers in footer');
                        console.log('Footer HTML:', htmlContent.substring(0, 200));
                        return false;
                    }
                } catch (e) {
                    console.error('Error loading data:', e);
                    console.error('Stack:', e.stack);
                    return false;
                }
            }

            // ========== META INFO ==========
            function updateMetaInfo() {
                const metaTotal = document.getElementById('meta-total');
                if (metaTotal) {
                    metaTotal.textContent = activityData.total_actions || 0;
                }

                const metaFormTitle = document.getElementById('meta-form-title');
                if (metaFormTitle) {
                    const title = (activityData.form_title || '').trim();
                    metaFormTitle.textContent = title ? `Form title: ${title}` : 'Form title: Not set';
                }

                const metaFormId = document.getElementById('meta-form-id');
                if (metaFormId) {
                    const formId = (activityData.form_id || '').trim();
                    metaFormId.textContent = formId ? `Form ID: ${formId}` : 'Form ID: Not set';
                }

                if (activityData.created) {
                    const created = new Date(activityData.created);
                    const metaCreated = document.getElementById('meta-created');
                    if (metaCreated) {
                        metaCreated.textContent = formatDateShort(created);
                    }
                }

                if (activityData.last_updated) {
                    const updated = new Date(activityData.last_updated);
                    const metaUpdated = document.getElementById('meta-updated');
                    if (metaUpdated) {
                        metaUpdated.textContent = formatDateTimeShort(updated);
                    }
                }

                updateSummaryCards();
            }

            function formatDateShort(date) {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            }

            function formatDateTimeShort(date) {
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function getEntryDate(entry) {
                if (entry.timestamp) {
                    return new Date(entry.timestamp);
                }
                if (entry.date && entry.time) {
                    return new Date(`${entry.date}T${entry.time}`);
                }
                if (entry.date) {
                    return new Date(entry.date);
                }
                return null;
            }

            function updateSummaryCards() {
                const entries = activityData.entries || [];
                const total = activityData.total_actions || entries.length;
                const authors = new Set(entries.map(entry => entry.author).filter(Boolean));

                document.getElementById('summary-total').textContent = total;
                document.getElementById('summary-authors').textContent = authors.size;

                const dates = entries.map(getEntryDate).filter(Boolean);
                if (dates.length) {
                    const minDate = new Date(Math.min(...dates));
                    const maxDate = new Date(Math.max(...dates));
                    document.getElementById('summary-range').textContent = `${formatDateShort(minDate)} - ${formatDateShort(maxDate)}`;
                } else {
                    document.getElementById('summary-range').textContent = '-';
                }

                const lastUpdated = activityData.last_updated ? new Date(activityData.last_updated) : (dates.length ? new Date(Math.max(...dates)) : null);
                document.getElementById('summary-updated').textContent = lastUpdated ? formatDateTimeShort(lastUpdated) : '-';
            }

            // ========== TABLE RENDERING ==========
            function renderTable() {
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';

                // Apply pagination
                const startIdx = (currentPage - 1) * rowsPerPage;
                const endIdx = rowsPerPage === -1 ? filteredEntries.length : Math.min(startIdx + rowsPerPage, filteredEntries.length);
                const pageEntries = filteredEntries.slice(startIdx, endIdx);

                // Render rows
                pageEntries.forEach((entry, idx) => {
                    const tr = createTableRow(entry, startIdx + idx);
                    tbody.appendChild(tr);

                    // Add details row if there are details
                    if (entry.details) {
                        const detailsTr = createDetailsRow(entry, startIdx + idx);
                        tbody.appendChild(detailsTr);
                    }
                });

                // Apply column widths after rendering
                applyColumnWidths();

                // Update pagination info
                updatePaginationInfo();

                // Show/hide no results message
                const noResults = document.getElementById('no-results');
                if (filteredEntries.length === 0) {
                    noResults.classList.add('active');
                } else {
                    noResults.classList.remove('active');
                }
            }

            function createTableRow(entry, index) {
                const tr = document.createElement('tr');
                tr.className = 'table-row';
                tr.dataset.index = index;

                if (selectedRows.has(index)) {
                    tr.classList.add('selected');
                }

                // Date cell
                const dateCell = document.createElement('td');
                dateCell.innerHTML = createDateCell(entry);
                tr.appendChild(dateCell);

                // Action type cell
                const actionCell = document.createElement('td');
                actionCell.innerHTML = `<span class="badge">${escapeHtml(entry.action_type || '')}</span>`;
                tr.appendChild(actionCell);

                // Description cell
                const descCell = document.createElement('td');
                descCell.className = 'cell-description';
                descCell.textContent = entry.description || '';
                tr.appendChild(descCell);

                // Author cell
                const authorCell = document.createElement('td');
                authorCell.className = 'cell-author';
                const authorContent = `<span class="cell-author-content"><span class="author-icon">&#x1F464;</span> ${escapeHtml(entry.author || 'Unknown')}</span>`;
                authorCell.innerHTML = authorContent;
                tr.appendChild(authorCell);

                // Details cell
                const detailsCell = document.createElement('td');
                detailsCell.className = 'cell-details-preview';
                const preview = (entry.details || '').substring(0, 50);
                const detailsContent = `<span class="cell-details-preview-content"><span class="expand-icon">&#x25B6;</span> ${escapeHtml(preview)}${entry.details && entry.details.length > 50 ? '...' : ''}</span>`;
                detailsCell.innerHTML = detailsContent;
                tr.appendChild(detailsCell);

                // Click handler for details
                detailsCell.style.cursor = 'pointer';
                detailsCell.addEventListener('click', () => toggleDetails(tr));

                return tr;
            }

            function createDateCell(entry) {
                let dateStr = '';
                let timeStr = '';

                if (entry.date) {
                    dateStr = entry.date;
                }
                if (entry.time) {
                    timeStr = entry.time;
                }
                if (!dateStr && entry.timestamp) {
                    const date = new Date(entry.timestamp);
                    dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                }
                if (!timeStr && entry.timestamp) {
                    const date = new Date(entry.timestamp);
                    timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                }

                return `
                    <div class="cell-date">
                        <span class="date-main">${dateStr}</span>
                        ${timeStr ? `<span class="date-time">${timeStr}</span>` : ''}
                    </div>
                `;
            }

            function createDetailsRow(entry, index) {
                const tr = document.createElement('tr');
                tr.className = 'table-row-details';
                tr.id = `details-${index}`;
                tr.style.display = 'none';

                const td = document.createElement('td');
                td.colSpan = 5;
                td.innerHTML = createDetailsContent(entry);
                tr.appendChild(td);

                return tr;
            }

            function createDetailsContent(entry) {
                return `
                    <div class="details-container">
                        ${entry.details ? `
                            <div class="details-section">
                                <div class="details-label">Details</div>
                                <div class="details-content">${escapeHtml(entry.details)}</div>
                            </div>
                        ` : ''}

                        <div class="details-meta">
                            <span>&#x1F4C5; ${entry.timestamp || ''}</span>
                            ${entry.location ? `<span>&#x1F4CD; ${escapeHtml(entry.location)}</span>` : ''}
                        </div>
                    </div>
                `;
            }

            function toggleDetails(row) {
                const index = row.dataset.index;
                const detailsRow = document.getElementById(`details-${index}`);

                if (detailsRow) {
                    const isHidden = detailsRow.style.display === 'none';
                    detailsRow.style.display = isHidden ? 'table-row' : 'none';
                    row.classList.toggle('expanded', isHidden);
                }
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text || '';
                return div.innerHTML;
            }

            // ========== FILTERING ==========
            function applyFilters() {
                const actionType = document.getElementById('filter-action-type').value;
                const author = document.getElementById('filter-author').value;
                const dateFrom = document.getElementById('filter-date-from').value;
                const dateTo = document.getElementById('filter-date-to').value;
                const searchTerm = document.getElementById('filter-search').value.toLowerCase();

                filteredEntries = activityData.entries.filter(entry => {
                    // Action type filter
                    if (actionType && entry.action_type !== actionType) {
                        return false;
                    }

                    // Author filter
                    if (author && entry.author !== author) {
                        return false;
                    }

                    // Date range filter
                    if (dateFrom || dateTo) {
                        const entryDate = new Date(entry.date || entry.timestamp);
                        if (dateFrom && entryDate < new Date(dateFrom)) {
                            return false;
                        }
                        if (dateTo && entryDate > new Date(dateTo)) {
                            return false;
                        }
                    }

                    // Search filter
                    if (searchTerm) {
                        const searchableText = [
                            entry.action_type,
                            entry.description,
                            entry.details,
                            entry.author
                        ].join(' ').toLowerCase();

                        if (!searchableText.includes(searchTerm)) {
                            return false;
                        }
                    }

                    return true;
                });

                // Reset to first page
                currentPage = 1;
                renderTable();
                updateResultsCount();
            }

            function populateFilterDropdowns() {
                const actionTypes = new Set();
                const authors = new Set();

                activityData.entries.forEach(entry => {
                    if (entry.action_type) actionTypes.add(entry.action_type);
                    if (entry.author) authors.add(entry.author);
                });

                // Populate action types
                const actionSelect = document.getElementById('filter-action-type');
                actionTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    actionSelect.appendChild(option);
                });

                // Populate authors
                const authorSelect = document.getElementById('filter-author');
                authors.forEach(author => {
                    const option = document.createElement('option');
                    option.value = author;
                    option.textContent = author;
                    authorSelect.appendChild(option);
                });
            }

            function clearFilters() {
                document.getElementById('filter-action-type').value = '';
                document.getElementById('filter-author').value = '';
                document.getElementById('filter-date-from').value = '';
                document.getElementById('filter-date-to').value = '';
                document.getElementById('filter-search').value = '';

                applyFilters();
            }

            function updateResultsCount() {
                document.getElementById('results-count').textContent = `${filteredEntries.length} shown`;
            }

            // ========== SORTING ==========
            function sortEntries(column, direction) {
                filteredEntries.sort((a, b) => {
                    let aVal = a[column] || '';
                    let bVal = b[column] || '';

                    // Handle dates
                    if (column === 'date') {
                        aVal = new Date(a.timestamp || a.date);
                        bVal = new Date(b.timestamp || b.date);
                    }

                    if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                    return 0;
                });

                renderTable();
            }

            // ========== PAGINATION ==========
            function updatePaginationInfo() {
                const total = filteredEntries.length;
                const startIdx = (currentPage - 1) * rowsPerPage;
                const endIdx = rowsPerPage === -1 ? total : Math.min(startIdx + rowsPerPage, total);

                document.getElementById('page-start').textContent = total > 0 ? startIdx + 1 : 0;
                document.getElementById('page-end').textContent = endIdx;
                document.getElementById('total-rows').textContent = total;

                const totalPages = rowsPerPage === -1 ? 1 : Math.ceil(total / rowsPerPage);
                document.getElementById('current-page').textContent = currentPage;
                document.getElementById('total-pages').textContent = totalPages;

                // Update button states
                document.getElementById('btn-first').disabled = currentPage === 1;
                document.getElementById('btn-prev').disabled = currentPage === 1;
                document.getElementById('btn-next').disabled = currentPage >= totalPages;
                document.getElementById('btn-last').disabled = currentPage >= totalPages;
            }

            function goToPage(page) {
                const totalPages = Math.ceil(filteredEntries.length / rowsPerPage);
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    renderTable();
                }
            }

            // ========== COLUMN VISIBILITY ==========
            function toggleColumn(column) {
                const th = document.querySelector(`th[data-column="${column}"]`);
                if (th) {
                    const table = document.getElementById('activity-table');
                    const headers = Array.from(table.querySelectorAll('th[data-column]'));
                    const targetIndex = headers.indexOf(th);  // Get position in ALL headers
                    const isVisible = !th.style.display || th.style.display !== 'none';

                    // Toggle header
                    th.style.display = isVisible ? 'none' : '';

                    // Toggle body cells using the same index position
                    table.querySelectorAll('tbody tr.table-row').forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells[targetIndex] && !row.classList.contains('table-row-details')) {
                            cells[targetIndex].style.display = isVisible ? 'none' : '';
                        }
                    });

                    // Update details rows colspan
                    table.querySelectorAll('tbody tr.table-row-details').forEach(row => {
                        const cell = row.cells[0];
                        if (cell) {
                            const visibleCount = headers.filter(h => !h.style.display || h.style.display !== 'none').length;
                            cell.colSpan = visibleCount;
                        }
                    });
                }
            }

            // ========== EXPORT ==========
            function exportToCSV() {
                const headers = ['Date', 'Action Type', 'Description', 'Author', 'Details'];
                const rows = filteredEntries.map(entry => [
                    entry.date || new Date(entry.timestamp).toLocaleDateString(),
                    entry.action_type || '',
                    entry.description || '',
                    entry.author || '',
                    entry.details || ''
                ]);

                let csv = headers.join(',') + '\n';
                rows.forEach(row => {
                    csv += row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',') + '\n';
                });

                downloadFile(csv, 'activity_log.csv', 'text/csv');
                showToast('Exported to CSV successfully!', 'success');
            }

            function exportToJSON() {
                const json = JSON.stringify({
                    version: activityData.version,
                    project_name: activityData.project_name,
                    total_actions: filteredEntries.length,
                    entries: filteredEntries
                }, null, 2);

                downloadFile(json, 'activity_log.json', 'application/json');
                showToast('Exported to JSON successfully!', 'success');
            }

            function downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }

            function copySelected() {
                if (selectedRows.size === 0) {
                    showToast('No rows selected', 'error');
                    return;
                }

                const entries = Array.from(selectedRows).map(idx => filteredEntries[idx]);
                const text = entries.map(entry => {
                    return `${entry.date || entry.timestamp} - ${entry.action_type}: ${entry.description}`;
                }).join('\n');

                navigator.clipboard.writeText(text).then(() => {
                    showToast(`Copied ${selectedRows.size} rows to clipboard`, 'success');
                }).catch(() => {
                    showToast('Failed to copy to clipboard', 'error');
                });
            }

            // ========== TOAST ==========
            function showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast toast-${type} show`;

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // ========== EVENT LISTENERS ==========
            function setupEventListeners() {
                // Filter changes
                document.getElementById('filter-action-type').addEventListener('change', applyFilters);
                document.getElementById('filter-author').addEventListener('change', applyFilters);
                document.getElementById('filter-date-from').addEventListener('change', applyFilters);
                document.getElementById('filter-date-to').addEventListener('change', applyFilters);
                document.getElementById('filter-search').addEventListener('input', debounce(applyFilters, 300));
                document.getElementById('btn-clear').addEventListener('click', clearFilters);

                // Sorting
                document.querySelectorAll('.data-table th[data-column]').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.dataset.column;
                        const direction = th.classList.contains('sort-asc') ? 'desc' : 'asc';

                        // Update sort indicators
                        document.querySelectorAll('.data-table th').forEach(h => {
                            h.classList.remove('sort-asc', 'sort-desc');
                        });
                        th.classList.add(`sort-${direction}`);

                        currentSort = { column, direction };
                        sortEntries(column, direction);
                    });
                });

                // Pagination
                document.getElementById('btn-first').addEventListener('click', () => goToPage(1));
                document.getElementById('btn-prev').addEventListener('click', () => goToPage(currentPage - 1));
                document.getElementById('btn-next').addEventListener('click', () => goToPage(currentPage + 1));
                document.getElementById('btn-last').addEventListener('click', () => goToPage(Math.ceil(filteredEntries.length / rowsPerPage)));
                document.getElementById('rows-per-page').addEventListener('change', (e) => {
                    rowsPerPage = parseInt(e.target.value);
                    currentPage = 1;
                    renderTable();
                });

                // Column visibility
                document.getElementById('btn-columns').addEventListener('click', () => {
                    document.getElementById('columns-modal').classList.add('active');
                });
                document.getElementById('btn-close-columns').addEventListener('click', () => {
                    document.getElementById('columns-modal').classList.remove('active');
                });

                document.querySelectorAll('.column-toggle input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const column = e.target.dataset.column;
                        toggleColumn(column);
                    });
                });

                // Export
                document.getElementById('btn-export').addEventListener('click', () => {
                    document.getElementById('export-modal').classList.add('active');
                });
                document.getElementById('btn-close-export').addEventListener('click', () => {
                    document.getElementById('export-modal').classList.remove('active');
                });
                document.getElementById('btn-export-csv').addEventListener('click', exportToCSV);
                document.getElementById('btn-export-json').addEventListener('click', exportToJSON);

                // Copy
                // Close modals on backdrop click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                        }
                    });
                });
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // ========== INITIALIZATION ==========
            function init() {
                if (loadData()) {
                    populateFilterDropdowns();
                    setupEventListeners();
                    renderTable();  // This will apply column widths
                    updateResultsCount();
                    console.log(`Loaded ${activityData.entries.length} entries`);
                } else {
                    document.getElementById('no-results').classList.add('active');
                    document.querySelector('.no-results-text').textContent = 'Failed to load activity data';
                }
            }

            // ========== COLUMN WIDTHS ==========
            function applyColumnWidths() {
                const table = document.getElementById('activity-table');
                const headers = Array.from(table.querySelectorAll('th[data-column]'));
                const columnWidths = {};

                // Read widths from headers
                headers.forEach(th => {
                    const column = th.dataset.column;
                    const width = th.dataset.width;
                    if (width) {
                        columnWidths[column] = width;
                    }
                });

                // Apply widths to header cells
                headers.forEach(th => {
                    const column = th.dataset.column;
                    if (columnWidths[column]) {
                        th.style.width = columnWidths[column] + 'px';
                        th.style.minWidth = columnWidths[column] + 'px';
                    }
                });

                // Apply widths to body cells using the same index as headers
                const allRows = table.querySelectorAll('tbody tr.table-row');
                allRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    headers.forEach((th, index) => {
                        const column = th.dataset.column;
                        if (columnWidths[column] && cells[index]) {
                            cells[index].style.width = columnWidths[column] + 'px';
                            cells[index].style.minWidth = columnWidths[column] + 'px';
                        }
                    });
                });
            }

            // Start
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>


</html>
